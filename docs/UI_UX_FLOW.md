# 介面流程與互動規範 (UI/UX Specification)

## 1. 啟動流程 (Onboarding)

1. **App 啟動**: 初始化 Hive 資料庫與依賴注入，驗證 Session。
2. **Case A (未登入)**:
   - 顯示 `LoginScreen`：Email + 密碼登入。
   - 提供「註冊」連結 → 跳轉至 `RegisterScreen`。
   - 提供「訪客模式」選項 (限制部分功能)。
3. **Case B (已登入但未驗證)**:
   - 跳轉至 `VerificationScreen`：輸入 6 位數驗證碼。
   - 提供「重新發送」按鈕 (30 秒冷卻)。
4. **Case C (已登入且已驗證)**: 直接進入主畫面。
5. **首次使用**: 觸發 9 步驟教學導覽。

## 2. 主導覽列 (Bottom Navigation - 4 Tabs)

### Tab 1: 行程 (Itinerary) - [預設首頁]

- **頂部 AppBar**:
  - 標題：「SummitMate」
  - 右上角區塊：
    - **編輯按鈕 (✏️)**: 開啟行程編輯頁面
    - **雲端同步 (☁️)**: 觸發與 Google Sheets 的同步與衝突檢測
    - **設定 (⚙️)**: 開啟設定對話框
- **日期切換**: D0 / D1 / D2 標籤按鈕
- **列表**: 垂直時間軸，顯示累積距離
- **Item 狀態**:
  - _未打卡_: 顯示 `預計: HH:mm`
  - _已打卡_: 顯示 `實際: HH:mm` (綠色高亮)
- **互動**:
  - **點擊 Item**: 展開 ModalBottomSheet
    - 顯示詳情 (海拔、距離、備註)
    - **Action Bar**:
      - `現在時間打卡`: 寫入 `DateTime.now()`
      - `指定時間`: 跳出 TimePicker
      - `清除`: 將 `actualTime` 設為 null
      - `編輯`: 進入行程編輯頁面
      - `刪除`: 移除此節點
  - **Toast 通知**: 打卡成功/失敗

### Tab 2: 協作 (Collaboration)

- **內含三個子頁籤**:
  - 💬 **留言板** - 團隊討論
  - 📊 **投票** - 團隊投票
  - 🍱 **菜單** - 公糧規劃

#### 子頁籤: 留言板

- **頂部**: 右上角「同步按鈕 (🔄)」
- **次級導覽**: 裝備 (Gear) / 行程 (Plan) / 其他 (Misc)
- **列表**:
  - 顯示留言卡片，含使用者頭像
  - 若有 `parentId`，則縮排顯示於父留言下方
  - 若 `message.user == me`，顯示「垃圾桶」圖示
- **新增**: 右下角 FAB (+) -> 彈窗輸入內容
- **同步狀態**: Toast 顯示同步成功/失敗

#### 子頁籤: 投票

- **列表**: 顯示所有投票卡片
  - 標題、狀態 (進行中/已結束)
  - 總票數、截止時間
- **新增**: 右下角 FAB (+) -> 建立投票頁面
- **點擊**: 進入投票詳情頁
  - 顯示各選項及票數
  - 可投票/改票
  - 顯示投票者列表

#### 子頁籤: 菜單

- 團隊公糧規劃 (記憶體儲存)

### Tab 3: 裝備 (Gear) - [獨立頁籤]

- **頂部 AppBar**:
  - 標題：「我的裝備」
  - 右上角：**雲端裝備庫按鈕 (☁️)**
- **總重量卡片**: 顯示當前總重量 (kg)
- **分類列表**:
  - 🛏️ 睡眠系統 / 🍳 炊具與飲食 / 👕 穿著 / 📦 其他
  - 使用 ExpansionTile 可展開收合
  - 每項顯示名稱、重量、打包狀態
- **新增**: 右下角 FAB (+)
  - 輸入名稱、重量、選擇分類
- **互動**:
  - 勾選/取消勾選打包狀態
  - 點擊刪除按鈕 → 確認對話框

### Tab 4: 資訊 (Info)

- **Section 1: 登山氣象**
  - 顯示向陽山 7 日天氣預報
  - 日/夜天氣圖示、溫度、降雨機率
- **Section 2: 外部資訊** (可摺疊)
  - 按鈕：`Windy (嘉明湖)` -> `launchUrl(windy_url)`
  - 按鈕：`中央氣象署 (三叉山)` -> `launchUrl(cwa_url)`
- **Section 3: 電話訊號資訊** (可摺疊)
  - 顯示各路段通訊覆蓋情況
  - 建議使用電信商

## 3. 次級頁面 (Sub-Pages)

### 登入頁面 (Login Screen)

- **進入點**: App 啟動時 (未登入)
- **表單欄位**: Email, 密碼
- **動作**:
  - 登入 → 驗證成功後進入主畫面 (或跳轉至驗證頁)
  - 註冊連結 → `RegisterScreen`
  - 訪客模式 → 直接進入主畫面 (限制功能)

### 註冊頁面 (Register Screen)

- **進入點**: 登入頁「立即註冊」連結
- **表單欄位**: Email, 密碼, 確認密碼, 暱稱, 頭像選擇
- **動作**:
  - 註冊 → 成功後跳轉至 `VerificationScreen`
  - 返回登入

### Email 驗證頁面 (Verification Screen)

- **進入點**: 註冊成功後 / 登入未驗證帳號
- **表單欄位**: 6 位數驗證碼輸入
- **動作**:
  - 驗證 → 成功後進入主畫面
  - 重新發送 (30 秒冷卻)

### 雲端裝備庫 (Gear Cloud Screen)

- **進入點**: 裝備頁右上角雲端按鈕
- **頂部工具列**:
  - 同步 / 上傳我的裝備 / 我的 Keys / 用 Key 查看
- **列表**: 顯示公開/保護的裝備組合
  - 標題、作者、總重量、裝備數
  - 可見性 icon (🌐 / 🔒 / 🔐)
- **互動**:
  - 點擊「查看」→ 預覽對話框
    - 分類縮合的裝備列表
    - 確認後下載覆蓋本地
  - 點擊「輸入 Key」→ Key 輸入對話框
  - 公開組合可直接刪除
- **上傳對話框**:
  - 輸入標題、選擇可見性
  - Protected/Private 需設定 4 位數 Key
  - 顯示預覽 (裝備數、總重量)

### 投票詳情頁 (Poll Detail Screen)

- **進入點**: 協作頁投票卡片
- **顯示內容**:
  - 標題、說明、截止時間
  - 各選項及進度條
  - 投票者列表（若為即時顯示）
- **互動**:
  - 點擊選項投票/取消
  - 新增選項（若允許）
  - 關閉/刪除投票（僅發起人）

### 建立投票頁 (Create Poll Screen)

- **進入點**: 協作頁投票 FAB
- **表單欄位**:
  - 標題 (必填)
  - 說明 (選填)
  - 初始選項 (至少 2 個)
  - 截止時間 (DateTimePicker)
  - 設定：允許新增選項 / 多選 / 盲投

### 行程編輯頁面 (Itinerary Edit Screen)

- **進入點**: Tab 1 右上角編輯按鈕或 BottomSheet 編輯按鈕。
- **表單欄位**:
  - 天數 (D0, D1...)
  - 名稱 (必填)
  - 預計時間 (TimePicker)
  - 海拔 (選填)
  - 里程 (選填)
  - 備註 (多行輸入)
- **動作**:
  - 儲存: 驗證並寫入 Hive。
  - 取消: 返回上一頁。

## 4. 設定與工具

### 設定對話框 (Settings Dialog)

透過 AppBar 右上角齒輪圖示開啟：

- 修改暱稱
- 修改頭像
- 離線模式開關
- 上次同步時間
- 查看日誌 (開啟 Log Viewer)

### 日誌查看器 (Log Viewer)

- **觸發**: 設定 -> 查看日誌
- **顯示**: ModalBottomSheet (可拖曳調整高度)
- **功能**:
  - 顯示最近 100 條日誌
  - 按等級區分圖示 (debug/info/warning/error)
  - 上傳到雲端按鈕 (Web 相容)
  - 清除所有日誌

### 教學導覽 (Tutorial Overlay)

- **觸發**: 首次使用自動觸發
- **步驟**:
  1. 歡迎訊息
  2. 行程頁介紹
  3. 打卡功能
  4. 編輯按鈕
  5. 同步按鈕
  6. 協作頁
  7. 裝備頁
  8. 資訊頁
  9. 完成

## 5. Web 版適配 (Responsive Design)

### Desktop / Large Screen

當螢幕寬度 > 600px 時：

- **Layout Wrapper**: 整個 App 內容被限制在 `maxWidth: 600px` 的容器中。
- **置中顯示**: 容器水平置中。
- **背景**: 兩側顯示背景色，模擬手機長寬比體驗。
- **目的**: 避免列表在寬螢幕上過度拉伸，保持單手操作的 UI 邏輯。

## 6. UI 設計準則 (Design Guidelines)

- **Theme**: 大自然淺色主題
  - Primary: 森林綠 `#2E7D32`
  - Background: 米色 `#FAF8F5`
  - Text: 深灰 `#1B1B1B`
  - Accent: 山脈藍 `#1565C0`
- **Typography**:
  - 關鍵數值 (海拔、時間) 需大於 18sp
  - 使用無襯線字體
- **動畫**:
  - 頁面切換使用 AnimatedSwitcher (250ms 淡入)
- **通知**:
  - 使用 SnackBar (Toast) 顯示操作結果
  - 成功：綠色 / 失敗：紅色 / 警告：橙色 / 資訊：藍色
- **確認對話框**:
  - 刪除操作需二次確認
  - 按鈕在輸入完成前保持禁用 (如 Key 輸入)

## 7. 成員管理流程 (Member Management)

### 7.1 成員列表 (Member List)

- **進入點**: 行程設定 (Trip Settings) -> 成員管理 (Members)
- **畫面功能**:
  - 顯示目前行程的所有成員。
  - 顯示角色徽章 (👑 Leader, 🐻 Guide, 🐰 Member)。
  - **Add (+)**: 新增成員 (見 7.2)。
  - **Edit**: 點擊成員可編輯權限 (僅 Leader 可見)。

```text
+----------------------------------+
| < Back      成員管理      Add +  |
+----------------------------------+
|                                  |
|  [擁有者]                        |
|  (👑) 王小明 (你)                |
|       Leader                     |
|                                  |
|  [嚮導/協作]                     |
|  (🐻) 陳大山              [Edit] |
|       Guide                      |
|                                  |
|  [成員]                          |
|  (🐰) 林小美              [Edit] |
|       Member                     |
|                                  |
+----------------------------------+
```

### 7.2 新增成員 (Add Member)

- **選項 1: 輸入 UUID**

  - 直接輸入對方提供的 User ID (精準比對)。

- **選項 2: Email 搜尋**
  - 輸入 Email -> 搜尋 -> 顯示結果 (頭像+名稱+ID) -> 確認加入。
  - _隱私注意_: 僅能精準搜尋，不支援模糊查詢。

```text
+----------------------------------+
|           新增行程成員           |
+----------------------------------+
|                                  |
|  搜尋方式:                       |
|  [ User ID ]  [ Email ]          |
|                                  |
|  輸入 Email:                     |
|  [ mountain.lover@gmail.com    ] |
|              [ 搜尋 ]            |
|                                  |
|  搜尋結果:                       |
|  (🐻) 登山客 123                 |
|       ID: e1a2...b4c5            |
|                                  |
|          [ 確認加入 ]            |
|                                  |
+----------------------------------+
```

### 7.3 編輯與權限設定 (Edit Role)

- **權限說明**:
  - **Member**: 僅檢視行程、編輯自己的裝備。
  - **Guide**: 可協助編輯行程、管理公裝、發布公告。
- **操作**: 選擇角色後儲存，或點選「移除成員」。

```text
+----------------------------------+
|           設定成員權限           |
+----------------------------------+
|                                  |
|  對象: 陳大山                    |
|                                  |
|  角色選擇:                       |
|  ( ) Member (一般成員)           |
|  (•) Guide (嚮導/協作)           |
|                                  |
|  [  移除成員  ]   [  儲存變更  ] |
|                                  |
+----------------------------------+
```

### 7.4 移交團長 (Transfer Ownership)

- **進入點**: 成員管理 -> 點擊自己 (Leader) -> 移交權限
- **流程**:
  1. 選擇繼任者 (必須為現有成員)。
  2. 顯示警告：「移交後您將失去管理行程的權限」。
  3. 輸入 `CONFIRM` 確認。
  4. 執行移交 API。

```text
+----------------------------------+
| ⚠️ 危險操作: 移交團長            |
+----------------------------------+
|                                  |
|  將團長權限移交給:               |
|  [ 陳大山 (Guide) ▼ ]            |
|                                  |
|  注意：                          |
|  移交後您將變成 Guide (嚮導)，   |
|  並失去管理行程的權限。          |
|                                  |
|  請輸入 "CONFIRM" 以確認:        |
|  [___________]                   |
|                                  |
|       [ 取消 ]  [ 確認移交 ]     |
+----------------------------------+
```
